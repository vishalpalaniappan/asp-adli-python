# Automated Diagnostic Log Injector (ADLI)

This tool is used to inject diagnostic logs into a python program. For more information on diagnostic logs, please see the [background](#Background) section. 
The CDL logs generated by running the injected source code can be viewed in the [Diagnostic Log Viewer][dlv]. 

# Usage

Run the tool using the following command (using Python 3.9+):

  ```shell
  python adli.py <source_path>
  ```

The program will generate an output folder which contains the injected source files with the original folder structure.

Running the program will generate a CDL file that can be viewed in the diagnostic log viewer.

# How does it work? 

The ADLI tool is designed to inject diagnostic logs into a python program. It uses the official python abstract syntax
tree library to parse the code and inject the logs.

ProgramProcessor:
* Accepts a source path to a python program.
* Finds all locally imported source files in the program.
* Parses each source file into an AST and processes it with the LogInjector class.

LogInjector:
* Uses the NodeTransformer class to visit nodes in the tree and inject diagnostic logs.
* Maintains a log type and variable map for each id and also track which function each log type and variable are part of. 

CollectVariableNames:
* Used to collect variable names from a given node by visiting child nodes.
* Generates a unique varid for each variable.
* Saves the varid and variable metadata (name, column etc..).
* For assign statements, it extracts the specific key that is being updated.

The logging setup is added to the injected AST's and they are unparsed and placed in the output folder while preserving the original program's folder structure. At this point, the injected source code can be run and it will generate a log file which can be viewed using the [Diagnostic Log Viewer][dlv].

# Background

> [!NOTE]  
> A more detailed introduction to diagnostic logging and the diagnostic tools it enables is in development.

CDL files are generated through a process called Diagnostic Logging (DL) in which the log type, variable values and exceptions for each statement in the program are logged. Diagnostic logging is enabled by Automated Diagnostic Log Injector (ADLI) tools, which automatically insert the necessary log statements to extract the diagnostic information.

The ADLI tool uses Abstract Syntax Trees (AST's) to traverse through the structure of the program to extract variable names and insert the necessary log statements for logtypes and variables. It inserts try except statements to catch any exceptions which occured when running the program and logs it. It also inserts a log statement to inject the log type map of the program into the header of the CDL file. This maps every logtype and variable to a line in the program. The enables us to only log the logtype id, effectively compressing the logtypes by default.

When diagnostic logs are ingested by CLP, having a map of the variables and log types will result in improved performance and a simpler implementation. It will be possible to further compress the logs by applying data specific compression to variables based on their variable type.

Using Diagnostic Logging, it is possible to build a fully automated log based diagnostic solution that can perform automated root cause analysis. In the next level of abstraction, it also automates the analysis, maintenance and recovery of systems. While all types of systems will benefit from diagnostic logging, distributed systems will benefit the most.

A simplified diagram of the diagnostic solution enabled by diagnostic logging is provided below.

![image](https://github.com/user-attachments/assets/429c667b-3b51-4171-becf-9bf946d0579f)

# Providing feedback

You can use GitHub issues to [report a bug][bug-report] or [request a feature][feature-req].

[bug-report]: https://github.com/vishalpalaniappan/asp-adli-python/issues/new?template=bug_report.md
[feature-req]: https://github.com/vishalpalaniappan/asp-adli-python/issues/new?template=feature_request.md
[dlv]: https://github.com/vishalpalaniappan/diagnostic-log-viewer
